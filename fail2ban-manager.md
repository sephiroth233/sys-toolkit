# fail2ban ç®¡ç†å·¥å…·

fail2ban å…¥ä¾µæ£€æµ‹å’Œé˜²æŠ¤ç³»ç»Ÿç®¡ç†è„šæœ¬ï¼Œæä¾›å®‰è£…ã€é…ç½®ã€Jail ç›‘æ§å’Œ IP ç®¡ç†åŠŸèƒ½ã€‚

é¡¹ç›®åœ°å€ï¼šhttps://github.com/sephiroth233/sys-toolkit

---

## ğŸ“¥ ä¸‹è½½å’Œå®‰è£…æ–¹å¼

### æ–¹å¼ä¸€ï¼šç›´æ¥æ‰§è¡Œï¼ˆæ¨èï¼‰
```bash
bash <(curl -fsSL https://raw.githubusercontent.com/sephiroth233/sys-toolkit/master/fail2ban-manager.sh)
```

### æ–¹å¼äºŒï¼šä¿å­˜åæ‰§è¡Œ
```bash
curl -fsSL https://raw.githubusercontent.com/sephiroth233/sys-toolkit/master/fail2ban-manager.sh -o fail2ban-manager.sh && bash fail2ban-manager.sh
```

---

## ğŸ¯ ä¸»è¦åŠŸèƒ½æ¨¡å—

### 1ï¸âƒ£ **æœåŠ¡å®‰è£…ä¸å¸è½½**
- **å®‰è£… fail2ban**ï¼šè‡ªåŠ¨æ£€æµ‹åŒ…ç®¡ç†å™¨å¹¶å®‰è£…
    - æ”¯æŒ apt/yum/dnf/pacman/zypper
    - è‡ªåŠ¨ç”Ÿæˆä¼˜åŒ–çš„ jail.local é…ç½®
    - å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡
- **å¸è½½æœåŠ¡**ï¼šå®Œå…¨åˆ é™¤æœåŠ¡å’Œé…ç½®æ–‡ä»¶

### 2ï¸âƒ£ **æœåŠ¡ç®¡ç†**
- **æœåŠ¡æ§åˆ¶**ï¼šå¯åŠ¨/åœæ­¢/é‡å¯ã€æŸ¥çœ‹çŠ¶æ€
- **æ™ºèƒ½çŠ¶æ€æ˜¾ç¤º**ï¼šå®æ—¶æ˜¾ç¤ºæœåŠ¡å®‰è£…å’Œè¿è¡ŒçŠ¶æ€

### 3ï¸âƒ£ **Jail å’Œ IP ç®¡ç†** â­
- **æŸ¥çœ‹ Jail çŠ¶æ€**ï¼šæ˜¾ç¤ºæ‰€æœ‰ Jail çš„è¿è¡ŒçŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯
- **æŸ¥çœ‹ç¦å° IP**ï¼šåˆ—å‡ºæ‰€æœ‰è¢«ç¦å°çš„ IP åœ°å€
- **æ‰‹åŠ¨ç¦å°/è§£ç¦ IP**ï¼šäº¤äº’å¼é€‰æ‹© Jail å¹¶ç®¡ç† IP

### 4ï¸âƒ£ **é…ç½®ç®¡ç†** ğŸ”§
- **æŸ¥çœ‹/ç¼–è¾‘é…ç½®**ï¼šä½¿ç”¨ vim/vi/nano ç¼–è¾‘å™¨
- **å¤‡ä»½/æ¢å¤é…ç½®**ï¼šè‡ªåŠ¨å¤‡ä»½åˆ° `/etc/fail2ban/backup/`

### 5ï¸âƒ£ **æ—¥å¿—ç®¡ç†**
- **æŸ¥çœ‹æœ€è¿‘æ—¥å¿—**ï¼šæ˜¾ç¤ºæœ€è¿‘ 100 æ¡æ—¥å¿—
- **æŸ¥çœ‹å®æ—¶æ—¥å¿—**ï¼šå®æ—¶è·Ÿè¸ªæ—¥å¿—ï¼ˆCtrl+C é€€å‡ºï¼‰

---

## ğŸ“Š é…ç½®æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ä½ç½® | ä½œç”¨ |
|:---|:---|
| `/etc/fail2ban/jail.local` | ä¸»é…ç½®æ–‡ä»¶ |
| `/etc/fail2ban/backup/` | é…ç½®å¤‡ä»½ç›®å½• |
| `/var/log/fail2ban/fail2ban.log` | æ—¥å¿—æ–‡ä»¶ |

---

## ğŸ¨ ç‰¹è‰²åŠŸèƒ½

### âœ… æ™ºèƒ½ç³»ç»Ÿæ£€æµ‹
- è‡ªåŠ¨æ£€æµ‹ Linux å‘è¡Œç‰ˆå’ŒåŒ…ç®¡ç†å™¨
- æ£€æµ‹ç³»ç»Ÿé˜²ç«å¢™ç±»å‹ï¼ˆufw/iptables/firewalldï¼‰

### âœ… ä¾èµ–è‡ªåŠ¨å®‰è£…
- è‡ªåŠ¨å®‰è£… fail2ban å’Œç¼–è¾‘å™¨ï¼ˆvim/vi/nanoï¼‰
- æ”¯æŒå¤šç§åŒ…ç®¡ç†å™¨

### âœ… é”™è¯¯æ¢å¤æœºåˆ¶
- é…ç½®ä¿®æ”¹å‰è‡ªåŠ¨å¤‡ä»½
- å¤±è´¥åè‡ªåŠ¨å›æ»š
- é…ç½®æ–‡ä»¶è¯­æ³•éªŒè¯

---

## ğŸ“‹ èœå•é€‰é¡¹é€ŸæŸ¥è¡¨

### **æœåŠ¡ç®¡ç†**
```
1.  å®‰è£… fail2ban
2.  å¸è½½ fail2ban
3.  åœæ­¢/å¯åŠ¨æœåŠ¡
4.  é‡å¯æœåŠ¡
5.  æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```

### **Jail å’Œ IP ç®¡ç†**
```
6.  æŸ¥çœ‹æ‰€æœ‰ Jail çŠ¶æ€
7.  æŸ¥çœ‹è¢«ç¦å°çš„ IP
8.  æ‰‹åŠ¨ç¦å° IP
9.  æ‰‹åŠ¨è§£ç¦ IP
```

### **é…ç½®ç®¡ç†**
```
10. æŸ¥çœ‹é…ç½®
11. ç¼–è¾‘é…ç½®
12. å¤‡ä»½é…ç½®
13. æ¢å¤å¤‡ä»½
```

### **æ—¥å¿—ç®¡ç†**
```
14. æŸ¥çœ‹æœ€è¿‘æ—¥å¿—
15. æŸ¥çœ‹å®æ—¶æ—¥å¿—
```

### **å…¶ä»–**
```
16. æŸ¥çœ‹å¸®åŠ©
0.  é€€å‡º
```

---

## ğŸš€ ä½¿ç”¨å»ºè®®

### **é¦–æ¬¡ä½¿ç”¨æµç¨‹**
- æ‰§è¡Œè„šæœ¬ â†’ é€‰é¡¹ 1 å®‰è£… â†’ é€‰é¡¹ 5 æ£€æŸ¥çŠ¶æ€
- é€‰é¡¹ 7 æŸ¥çœ‹è¢«ç¦å°çš„ IP â†’ é€‰é¡¹ 14 æŸ¥çœ‹æ—¥å¿—

### **å¸¸ç”¨å‘½ä»¤æ¨¡å¼**
```bash
# æœåŠ¡ç®¡ç†
sudo ./fail2ban-manager.sh install
sudo ./fail2ban-manager.sh start|stop|restart|status

# Jail ç®¡ç†
sudo ./fail2ban-manager.sh jail-status
sudo ./fail2ban-manager.sh view-banned
sudo ./fail2ban-manager.sh ban-ip|unban-ip

# é…ç½®ç®¡ç†
sudo ./fail2ban-manager.sh view-config|edit-config
sudo ./fail2ban-manager.sh backup-config|restore-config

# æ—¥å¿—æŸ¥çœ‹
sudo ./fail2ban-manager.sh view-logs|realtime-logs
```

---

## âš ï¸ å‰ç½®è¦æ±‚

- Linux æœåŠ¡å™¨ï¼ˆæ”¯æŒ systemdï¼‰
- Root æƒé™æˆ– sudo èƒ½åŠ›
- ç½‘ç»œè¿æ¥ï¼ˆä¸‹è½½è½¯ä»¶åŒ…ï¼‰

---

è¿™ä¸ªè„šæœ¬æ˜¯ä¸€ä¸ª**å®Œæ•´çš„ fail2ban ç®¡ç†è§£å†³æ–¹æ¡ˆ**ï¼Œç‰¹åˆ«é€‚åˆéœ€è¦å¿«é€Ÿéƒ¨ç½²å…¥ä¾µæ£€æµ‹å’Œé˜²æŠ¤ç³»ç»Ÿçš„ç”¨æˆ·ï¼ ğŸ›¡ï¸